---
title: "Sexual signaling strategy shows no influence on the morphometrics of firefly's primary olfactory organs"
author: 
 - Lindsay D. Waldrop^1^, Daniel Mejia^1^, Noelle Clark^1,2* ^, Ricardo Espanoza Hernandez^1^,
 - Redah Jessani^1^, Karen Ngo^1^, Karishma Setya^1^
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
    number_sections: false
    toc: false
    keep_tex: yes
bibliography: references.bib
csl: zootaxa.csl
---

 1. Schmid College of Science and Technology, Chapman University, 1 Univ Dr. Orange CA 92866
 2. Department of Genetics, University of Georgia, Athens, GA, 30602, \* Current affiliation

Running title: Sex signaling effects on firefly antenna (40 characters)

Corresponding author: 

Lindsay D. Waldrop, Ph.D.

Email: waldrop@chapman.edu

Address: 
1 Univ Dr
Keck Center
Orange, CA 92866

Phone: +1 (714) 516-5615

# Author Contributions

 - LDW - conceived of idea, collected data, analyzed data, wrote manuscript, edited manuscript, provided materials and support
 - DM - collected data, analyzed data, wrote manuscript, edited manuscript
 - NC - collected data, analyzed data, edited manuscript
 - REH - collected data, analyzed data, edited manuscript
 - KS - collected data, analyzed data, edited manuscript
 - KN - collected data, analyzed data, edited manuscript


# Abstract

Fireflies (beetles in the family Lampyridae) are known for the development of bioluminescent organs which flash or glow to mediate sexual reproduction in many species, affecting the eye size of species which employ this signaling strategy. Other species of fireflies have secondarily reverted to using olfactory signals (pheromones) to attract mates. In this study, we investigate the primary olfactory organ of fireflies (antenna) to determine whether the reversal to chemical signaling has similarly affected the morphometrics of this organ. We hypothesize that species using chemical signaling would have greater densities and counts of olfactory sensilla responsible for capturing pheromones, as well as longer and wider olfactory sensilla, compared to species using visual signals (flashing or glowing). We also hypothesize that male animals would have greater number and densities of olfactory sensilla as compared to female animals. We find that neither signaling strategy nor sex has a significant relationship with any morphometric measurement examined. The combination of sex and signal strategy was also not a significant predictor of any morphometric measurement. Olfactory sensilla arrays are likely used for a variety of tasks not linked to sexual signaling strategies. The form and arrangement of olfactory sensilla could represent the smallest, most compact, and inexpensive way to create and maintain these arrays. Consistent with previous work, no differences between male and female animals suggest that females possess the same sensilla that react to sex pheromones but either they are not physiologically active or these signals are ignored.

## Keywords

Lampyridae, odor capture, pheromone, sexual selection

\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())

# If you would like to regenerate figures, set the next line to TRUE:
regen_figs <- FALSE
# If you would like to rerun all analyses, set the next line to TRUE:
rerun_analyses <- FALSE
# Saves figures during knit if TRUE: 
save_figs <- FALSE

# Loads required packages
library(knitr)
library(ggplot2)
library(patchwork)
library(RColorBrewer)
library(dplyr)
library(janitor)
library(ggtree)
library(cowplot)
library(ggrepel)
library(viridis)

dir.create("../results/", showWarnings = F)
dir.create("../results/plots", showWarnings = F)

signal_colors <- brewer.pal(3, "Set2")
sex_colors <- brewer.pal(8, "Dark2")[c(2,3,8)]
sensillum_colors <- c("lightcoral", "steelblue1")
olfactory_colors <- viridis(3)
```

```{r load-data, include=FALSE}
# Load custom functions:
source("./src/data-handling-fxns.R")

if(rerun_analyses){
  # Rerun analysis if rerun_analyses is true
  source("./src/paper_analysis.R")
  analysis_date <- Sys.Date()
} else {
  analysis_date <- "2025-03-11"
}

# Loads specimen list
specimen_data <- load_specimen_data(include_unmeasured = F)

# Loads analyzed width, length data: 
morpho_data <- load_morphometric_data(specimen_data, analysis_date)

# Loads density, mean dist, count data:
all_xy <- load_xy_data(analysis_date)
all_xy <- estimate_counts(specimen_data, morpho_data, all_xy)
all_xy$density <- all_xy$density*1e6
# Reshapes data for plotting counts: 
all_segs_olf <- all_xy[all_xy$sensillum_type == "olfactory" &
                                    all_xy$olfactory_type == "all" , ]  %>%
    group_by(species, signal) %>%
    summarise(mean_est = mean(est_seg_count, na.rm = T), 
              sd_est  = sd(est_seg_count, na.rm = T))


```

```{r arrange-tree, message=FALSE, warning=FALSE, include=FALSE}
# Adding a phylogenetic tree to the analysis

# Please see MakeATree.R script for more information on how this tree was constructed.
if(rerun_analyses) source("./src/MakeATree.R")

# Read the tree file from MakeATree.R in: 
bug_tree <- ggtree::read.tree("./data/trees/Treefor26species.tree") 
bug_tree$tip.label <- sub("_", " ", bug_tree$tip.label)

# Setup signal and count per segment data frame to join with bug tree:
specimen_list <- load_specimen_data(F, F)
specimen_list$species <- factor(specimen_list$species)
specimen_list$signal <- factor(specimen_list$signal, 
                               levels = c("visual", "chemical", "both"))
signal_data <- unique(specimen_list[,c("species", "signal")])
colnames(signal_data) <- c("label", "signal")
signal_data$label <- as.character(signal_data$label)
temp_all_segs_olf <- all_segs_olf[,c("species", "mean_est")]
colnames(temp_all_segs_olf) <- c("label", "mean_est")
signal_data_2 <- left_join(signal_data, temp_all_segs_olf, by = "label")

# Join signal data to bug tree for plotting:
bug_tree_2 <- full_join(bug_tree, signal_data_2, by = "label")
```

```{r run-stats-figs, message=FALSE, warning=FALSE, include=FALSE}
# Testing the mean distances between hairs, hair counts, hair densities, and hair fractions with a phylogenetically corrected ANOVA. Each test line will generate the phylo ANOVA, a regular ANOVA (uncorrected), and a plot that shows the comparison. Many of the plots are used below in the manuscript. The p-values from the phylo ANOVAs are compiled in the tables below.  
source("./src/paper_run_stats.R")
```

```{r tab-code, include=FALSE}
# This code arranges the p-values of the phylo ANOVAs into table format
source("./src/paper_setup_tables.R")
```

 
# Introduction

## Sexual signaling strategies of the Lampyridae

Beetles in the family Lampyridae are famously known for their unique bioluminescence – lighting up dark nights of their mating seasons and fascinating people all over the world. Many lampyrid beetles use bioluminescent organs on their abdomens (lanterns) to produce flashing or glowing signals which attract conspecific mates [@lloyd1969flashes; @carlson1985flash; @de2014courtship]. Fireflies using bioluminescent organs have adopted a nocturnal habit to accompany the signals, and the illuminated patterns and colors help to distinguish between species [@lloyd1969flashes; @ohba2004flash; @stanger2007phylogeny; @de2014courtship; @stanger2015flash; @pacheco2024antennal]. Male fireflies search for conspecific females, and as a result, sexual selection has influenced males’ eyes to be relatively larger to detect females’ visual signals from afar [@stanger2018evolution].
 
Though bioluminescence is a distinguishing trait for the family, some lampyrid beetles have secondarily reverted to using specialized chemical signals (pheromones) to attract mates from a distance [@mcdermott1964taxonomy; @branham2003origin]. Females release pheromones that drift through the air, and males detect these signals with primary olfactory organs (antennae) and track the signal to the female [@lloyd1969flashes; @lloyd1997; @de2005sexual;  @stanger2007phylogeny; @pacheco2024antennal]. Species using pheromones are primarily diurnal and have reversed away from visual signaling several times independently [@stanger2007phylogeny; @pacheco2024antennal].
 
Across many species of insects employing chemical signaling, many have longer antennae to provide more sensory surface area for detecting rare chemical signals [@hansson2011evolution; @de2005sexual; @stanger2018evolution]. Has selection produced a similar effect on firefly species that have secondarily reverted to chemical signaling?
 
## Antennae of lampyrid beetles
 
The antennae of lampyrid beetles are complex structures that serve many functions, including the detection of chemical, thermal, and tactile cues. Fireflies have two antennae, each of which are made up of multiple small segments, or antennomeres, each bearing many sensory sensilla (Fig. \@ref(fig:sem-fig)). Fourteen sensilla morphotypes on the antennae of the Lampyridae beetles have been identified, which are organized into four functional groupings: mechanoreceptors, chemoreceptors, hygroreceptors, and thermoreceptors [@schneider1964insect; @keil1984mechanosensitive; @steinbrecht1987functional; @keil1997functional; @yao2005chemosensory; @tichy2010insect; @chakilam2020morphological; @geerthana2023sensory; @pacheco2024antennal]. @schneider1964insect presents an overview of these sensilla types and their associated functions for insects, and @pacheco2024antennal presents a similar overview focusing on fireflies. 
 
Within chemoreceptors, olfactory sensilla receive many different types of chemical vapor signals in the air (odorants) and can be used for the detection of plant volatiles, aggregation pheromones, sex pheromones, and more [@keil1984mechanosensitive; @lopes2002fine; @pacheco2024antennal]. Olfactory sensilla are typically shorter than other types (such as mechanosensory sensilla) and by necessity contain pores. Pores allow for air containing odorants to be exposed to the outer dendritic segments that transduce signals into action potentials. Other aspects of olfactory sensilla, such as pore size and distribution, length, width, or aspect ratio, can differ between sensilla types and across species [@faucheux2017comparative; @pacheco2024antennal]. To date, only basiconica sensilla have been identified as responsive to sex pheromones through electrophysiology [@lower2023identification].
 
## Fluid dynamics of pheromone capture

In order for a male firefly to capture pheromones released by a female, the pheromone must travel via air currents to and come into contact with the olfactory structures of the male's antennae. The process of odor capture involves the small-scale fluid flow in which odorant molecules come sufficiently close to the antenna's surface for diffusion to carry molecules to contact with receptors in olfactory sensilla. Odor capture depends on the interactions between the solid structures of the antenna and the fluid containing pheromone molecules.
 
Previous work has shown that the shape, size, and arrangement of sensilla on the antenna influence the fluid flow near the surface of sensilla, and therefore these features are an important component in the dynamics of how much available odorant is captured [@koehl2011; @waldrop2018entmodel; @jaffar2020insect]. Studies have shown that these morphometrics impact odor-capture performance for a variety of pancrustaceans, although fewer studies have focused on insects [@Loudon2000; @waldrop2016hermitcrab; @waldrop2018entmodel; @jaffar2020insect]. 

It is generally assumed that a greater surface area of chemosensory structure or a larger number of chemoreceptor sensilla would be associated with sex pheromone signaling, driven primarily by sexual selection. A greater sensor surface area or number would be required to detect the rare signal of sex pheromones. Previous works have found that diurnal (chemical signalers) fireflies had longer antennae and greater sensilla densities than nocturnal species (visual signalers) and diurnal males have a greater number of total chemosensilla than diurnal females [@stanger2018evolution; @pacheco2024antennal].

However, the connection between sexual dimorphic antennae and rare odorant signals is not as clear with other insects that use pheromones to mediate reproduction. Moths are a common example of insects with antennae that are variably sexually dimorphic, with the males of many species having large, plumose antennae compared to the smaller, less dense antennae of females. Although it is assumed that this dimorphism is associated with properties of female pheromones or population density, @symonds2012pheromone found no such link. @johnson2022movement found that greater dimorphism was linked to increased male competition for females, rather than factors affecting the rarity of sex pheromone signals. Body size seems to be the most significant correlate for plumose male antenna in moths [@symonds2012pheromone; @javoivs2019comparative; @johnson2022movement]. 

Furthermore, there is a potential trade off with increased surface area and the density of sensory structures. A greater number of sensilla imparts greater surface area available to capture odorant molecules, but because of the tendency of small-scale fluid flow to travel around, rather than through, hair arrays, antennae with denser sensilla arrays often require active ventilation or more specialized structures to effectively use the additional sensory surface area provided by more complex structures [@Loudon2000; @loudon2005divergence; @waldrop2016bluehermit; @waldrop2018entmodel; @jaffar2020insect; @nakata2024olfactory]. Increased number or density of sensilla therefore could incur significant energetic costs or not impart a greater effective sensory area compared to sparser arrays. 

## Study hypotheses

In this study, we quantify the morphometrics and arrangement of mechanosensory and olfactory sensilla on the antennae of lampyrid beetles of different sexual signaling strategies to determine the influence sexual selection has had on these structures. We measure full antennae of three sexual-signaling strategies for attracting conspecifics at distance: chemical (diurnal and relying exclusively on pheromones), visual (nocturnal and relying exclusively on bioluminescent light signals), and combined (relying on a combination of both light and pheromone signals). We focus on quantifying the morphometrics of sensilla hypothesized to be strictly olfactory (trichodea and basiconica) and mechanosensory sensilla as a control for the effects of sexual selection. 

We hypothesize that visual signalers will have a reduction in the width and length of olfactory sensilla compared to chemical signalers; visual signalers will have fewer olfactory sensilla overall, with a lower density and higher mean distance between sensilla than chemical signalers; male animals will have more olfactory sensilla than female animals at a higher density than female animals; and male animals should have a higher number and fraction of basiconica sensilla, based on its responsiveness to sex pheromones by @lower2023identification. 

# Materials and Methods

## Materials 

Individual samples of species listed in Table \@ref(tab:bug-tab) were acquired from the entomology collection of the Los Angeles County Natural History Museum, representing 32 individual animals and 26 species. Each specimen was destructively sampled by the removal of an entire antenna. Only specimens with intact antennae were sampled, although during sampling and transport to Chapman University, some segments were lost. Each specimen was photographed to recover body length and sex. Two specimens lacked abdominal segments and were unable to be sexed, and these are marked in Table \@ref(tab:bug-tab) as "NA." 

```{r bug-tab, echo = FALSE}
specimen_tab <- specimen_data[,c(1,2,4,5,6)]
sp_tab_col_names <- c("Specimen ID", "Species", "Signal", 
                      "Sex", "Body length (mm)")

kable(specimen_tab, "simple",
      digits = 1,
      align = c("l", "l", "c", "c", "c"),
      col.names = sp_tab_col_names,
      caption ="Specimens used in analysis from the Los Angeles County Natural History Museum (LACM). Specimen ID is a specimen number unless BPC (Brian Brown personal collection) or NCC (individual specimens in the LACM collection not yet given a specimen number). ")
```

```{r sem-fig, echo=FALSE, warning=FALSE, message=FALSE, fig.cap="a. Scanning electron micrograph (SEM) of ventral side of \\textit{Photinus macdermotti} showing antenna with labeled scape, pedicle, and flagellomeres 1 -- 9. b. SEM of ventral side of F1 segment of \\textit{Lucidota} sp. specimen LACM Ent 574192 show locations of width measurements on mechanosensory sensilla (A, B, C in green) and olfactory sensilla (B in gold). trichodea (T) and basiconica (W) olfactory sensilla are also marked in white."}
ggdraw() + draw_image("./doc/figures/figure1/SEM_fig.png")
```

Each species was categorized by mating strategy: visual (primarily nocturnal species using light signals to mediate long-distance mate attraction), chemical (primarily diurnal species using pheromones to mediate long-distance mate attraction), or both (either nocturnal or diurnal species using some combination of pheromones and light to mediate long-distance mate attraction). Natural history required to determine category for each species was collected from a variety of published sources [@ohba1983studies; @carlson1985flash; @ohba2004flash; @stanger2007phylogeny; @lewis2008flash; @stanger2015flash; @faust2017fireflies; @stanger2018evolution].

```{r bug-tree, echo=FALSE, warning=FALSE, message=FALSE, fig.height=4.5, fig.width=7.5, fig.cap="a. Phylogenetic tree of 26 species with colors indicating sexual signaling strategy for that species. b. Dorsal view of \\textit{Lucidota} sp. specimen LACM Ent 574192. c. Ventral view of \\textit{Photinus consanguineus} specimen NCC Ent 10."}

p_tree <- ggtree(bug_tree_2) + 
  geom_tiplab(offset = 0.04) + 
  geom_tippoint(aes(fill = signal), 
                color = "black", shape = 21, size = 3) +
  scale_fill_manual(values = signal_colors) +
  ggplot2::xlim(0,2) +
  theme(legend.position = "bottom")
p_pic1 <- ggdraw() + draw_image("./doc/figures/figure2/Lucidota_sp.JPG")
p_pic2 <- ggdraw() + draw_image("./doc/figures/figure2/Photinus_consanguineus.JPG")
p_tree + (p_pic1 / p_pic2) +
  plot_layout(widths = c(5, 1)) +
  plot_annotation(tag_levels = "a") & theme(plot.tag = element_text(color = "black", 
                                                                    face = "plain"))
if(save_figs) {
  ggsave("./doc/figures/figure2/bug_tree.pdf", last_plot(), height = 4.5, width = 7.5)
}
```


## Scanning Electron Microscopy

Each antenna was mounted separately to SEM tape using light pressure with forceps such that the medial posterior side of the antenna was available for view. If fractured, segments were mounted together at the point of fracture to maintain the order of antenna segments. A soft paintbrush was used under a stereoscope to remove any debris and dust on the antennae before processing for electron microscopy. 

SEM images were taken on a Sigma 300 Electron microscope by Zeiss (Carl Zeiss Microscopy, LLC White Plains, NY). Specimen samples were coated with a thin layer of gold/palladium (Au/Pd 80/20%) using a sputter coater model SC7620 by Quorum. Argon gas was used in the vacuum chamber (Zero Grade: 99.999%) fitted with a two-stage regulator with pressure around 5-10 psi (0.5 bar).  The sputter coater was run for 45 s at 18 mA to achieve a thickness of about 3 -- 4 nm. Depositing conductive thin films helps inhibit "charging," reduces thermal damage, and enhances secondary electron emission for better imaging. The SEM operating voltage was maintained within 10 -- 25 kV, and the SE2 detector was used with a WD of 10.5 mm. Electron micrographs were recorded and processed using the SmartSEM imaging software provided by Zeiss.  

SEMs of each specimen were taken of the entire antenna and individually of the pedicle and each flagellar segment. SEMs of each flagellar segment were taken to capture the entire segment in one view and a higher-magnification view to focus on a cluster of individual sensilla.


## Morphometric measurements

Morphometric measurements were collected from SEMs using ImageJ [@ImageJ]. After scaling the image, lengths and widths were measured with a linear measurement tool. Total antenna length was measured on the entire specimen view. Individual lengths and widths of segments were recorded after measurements on the individual view that captured the entire segment. Segment lengths were found by measuring the widest point along the segment and segment width was measured at the midpoint of the segment's length. 

Sensilla were identified as either mechanosensory, olfactory, or hygrothermal. Within these main categories, two categories of olfactory sensilla were also recorded (trichodea or basiconica). All sensilla were identified visually based on the following morphological markers: 

 - Mechanosensory: sensilla consisted of long structures with a mechanical base or connection to the flagellar segment. Both chaetica and campaniform morphotypes of mechanoreceptors were analyzed as simply mechanoreceptors and not identified by type.
 - Trichodea (olfactory): sensilla consisted of porous, short, narrow-diameter structures being either straight or slightly curved with fixed connections to the flagellar segment.
 - Basiconica (olfactory): sensilla consisted of porous, bulbous structures that were nearly as wide as they were long with fixed connections to the flagellar segment. 
 - Hygrothermal (capitular): sensilla consisted of very short, button-like structures which had a based wider than the sensillum was long.

Morphometric measurements collected on sensilla consisted of length and widths. Sensillum length was recorded from the middle of the base of the sensillum to the distal tip. If curved, a line segment tool was used to fit the curve of the sensillum to provide a total length. Sensilla widths were measured at three points along the length: near the distal-most end, near the midpoint, and near the proximal end. Each measurement was repeated on three sensilla of each main type (mechanosensory or olfactory) per flagellar segment. 

Sensillum arrangements were collected by digitizing the two-dimensional location of the center of the proximal end (base) of each sensillum where it connected to the flagellar segment. All sensilla in an arbitrary area on each flagellar segment were digitized, given that the area met the following conditions: the base of each sensillum was able to be digitized, each sensillum could be categorized, and the area was away from the edges of the segment where it curved out of plane. From the digitized locations, custom R software was used to calculate the density (counts / area digitized), mean distance between sensilla, and fraction of sensillum type for each specimen. Total sensillum counts were estimated by using the density for each flagellar segment along with the estimated area of the flagellar segment (two times the segment width times segment length). 


## Statistical analysis

To evaluate comparisons based on signaling strategy, species means were calculated separately for mechanosensory sensilla,  olfactory sensilla, and all sensilla. Combined visual/chemical signaling species (*Phausis reticulata* and *Microphotus angustus*) were grouped with chemical signalers for the purpose of statistical testing. A phylogenetically corrected ANOVA in the *phytools* package [@phytools] in R version 4.4.1 [@R] was performed using simulation-based $p$-value calculations with pairwise posthoc test using Holm method for each comparison using a reconstructed tree of Lampyridae (Fig.~\@ref(fig:bug-tree)) based on @martin2019higher and @stanger2015flash.  No comparison was significant at $\alpha < 0.05$. Table \@ref(tab:signal-ptable) provides a summary of $p$-values. 

To evaluate comparisons based on sex, specimen means were calculated separately for mechanosensory sensilla, olfactory sensilla, and all sensilla. One-way ANOVAs were performed in R version 4.4.1 [@R] for each comparison on specimen means. No comparison was significant at $\alpha < 0.05$. Table \@ref(tab:sex-ptable) provides a summary of $p$-values. 

Measurements were not normalized to body length because each measure was determined to be independent of body length through linear regression. Each statistical analysis was repeated taking body length into account and there were no changes in significance for any measure. Additional statistical values can be found in Supplemental Information. 


## Data Availability

All measurements and code necessary to reproduce the phylogenetic tree, calculations, figures, and statistical analyses are available on Github: https://github.com/lindsaywaldrop/firefly-morphology. 


# Results

## Signaling strategy does not affect sensillum morphometrics or arrangements

```{r signal-ptable, message=FALSE, warning=FALSE}
kable(tab_signal_df, "simple",
      digits = 3, align = "c",
      #row.names = tab_row_names,
      col.names = tab_col_names,
      caption = "Phylogenetically corrected $p$-value comparisons of species means against signal type. Number of species in the comparison ($n$) is noted in parentheses beside each value.")
```

```{r summary-values-signal, include=FALSE}
mean_width_signal <- test_widths_signal$bar_means %>%
  group_by(sensillum_type, signal) %>%
  summarize(means = mean(mean, na.rm=T), sds = sd(mean, na.rm=T))

mean_length_signal <- test_lengths_signal$bar_means %>%
  group_by(sensillum_type, signal) %>%
  summarize(means = mean(mean, na.rm=T), sds = sd(mean, na.rm=T))

mean_density_signal <- test_all_density_signal$bar_means %>%
  group_by(sensillum_type, signal) %>%
  summarize(means2 = mean(means, na.rm=T), sds = sd(means, na.rm=T))
colnames(mean_density_signal)[3] <- "means"

mean_counts_signal <- test_all_counts_signal$bar_means %>%
  group_by(sensillum_type, signal) %>%
  summarize(means2 = mean(means, na.rm=T), sds = sd(means, na.rm=T))
colnames(mean_counts_signal)[3] <- "means"

mean_counts_all <- all_xy %>%
  group_by(sensillum_type, olfactory_type, signal, sex, species) %>%
  summarize(means = mean(est_seg_count, na.rm=T), sds = sd(est_seg_count, na.rm=T))

mean_counts_olf_signal <- all_xy[all_xy$sensillum_type == "olfactory" & all_xy$olfactory_type != "all",] %>%
  group_by(olfactory_type, signal, species) %>%
  summarize(means = mean(est_seg_count, na.rm=T), sds = sd(est_seg_count, na.rm=T))

mean_counts_olf_sex <- all_xy[all_xy$sensillum_type == "olfactory" & all_xy$olfactory_type != "all",] %>%
  group_by(olfactory_type, sex, species) %>%
  summarize(means = mean(est_seg_count, na.rm=T), sds = sd(est_seg_count, na.rm=T))

est_total_hairs <- all_xy %>%
  group_by(specimen, species, sex, signal, sensillum_type, olfactory_type, location) %>%
  summarize(mean_counts = mean(est_seg_count, na.rm=T), sds = sd(est_seg_count, na.rm=T)) %>%
  filter(sensillum_type == "olfactory" & olfactory_type == "all") 

complete_ant_specimens <- unique(as.character(specimen_data$specimen[specimen_data$antenna_complete == "yes"]))

tmp <- sapply(complete_ant_specimens, function(x) grepl(x, est_total_hairs$specimen))
est_complete_counts <- est_total_hairs[apply(tmp, 1, sum) > 0, ]

est_complete_counts_species <- est_complete_counts %>%
  group_by(specimen, species, sex, signal) %>%
  summarise(total = sum(mean_counts, na.rm=T)) %>%
  group_by(species, sex, signal) %>%
  summarize(mean_total = mean(total, na.rm=T))

est_complete_counts_species$signal[est_complete_counts_species$signal == "both"] <- "chemical"

```

```{r signal-plots, warning=FALSE, message=FALSE, fig.height=5.5, fig.width = 6.5, fig.cap="Mean widths of the medial sensilla (a) and mean lengths of sensilla (b) of both mechanosensory and olfactory sensilla across all three signal types. See Table \\@ref(tab:signal-ptable) for sample sizes and p-values for each comparison."}

p_width_signal <- test_widths_signal$plot + scale_fill_manual(values = signal_colors)
p_length_signal <- test_lengths_signal$plot + scale_fill_manual(values = signal_colors)
p_signal_density <- test_all_density_signal$plot + 
  scale_fill_manual(values = signal_colors, guide = F)
p_signal_dists <- test_all_mean_dists_signal$plot + 
  scale_fill_manual(values = signal_colors, guide = F)
p_signal_counts <- test_all_counts_signal$plot + 
  scale_fill_manual(values = signal_colors)


(p_length_signal + p_width_signal) / 
  (p_signal_density + p_signal_dists) / 
  #(free(p_signal_counts)) + 
  plot_layout(guides = "collect")  +
  plot_annotation(tag_levels = "a")& theme(legend.position = "bottom", 
                                          plot.tag = element_text(vjust = 2))

if(save_figs){
  dir.create("./doc/figures/figure3/", showWarnings = F)
  ggsave("./doc/figures/figure3/signal-plots.pdf", last_plot(), 
         height = 5.5, width = 6.5)
}
```

Table \@ref(tab:signal-ptable) presents $p$-values and sample sizes of phylogenetically corrected ANOVAs for various comparisons of sensilla against signaling strategy. Full test statistics can be found in Supplemental Information. Figures \@ref(fig:signal-plots) present results for species means with ranges divided by signaling strategy. Both olfactory and mechanosensory sensilla share similar widths. Species mean olfactory sensillum widths are 
$`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "visual"], digits = 1)` ~\mu$m for visual signalers, 
$`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "chemical"], digits = 1)` ~\mu$m for chemical signalers, and 
$`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "both"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "olfactory" & mean_width_signal$signal == "both"], digits = 1)` ~\mu$m for species displaying both strategies with no significance between means (Fig. \@ref(fig:signal-plots)a). Similar widths were found for mechanosensory sensilla across species 
($`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "visual"], digits = 1)` ~\mu$m, 
$`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "chemical"], digits = 1)` ~\mu$m, and 
$`r signif(mean_width_signal$means[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "both"], digits = 3)` \pm `r signif(mean_width_signal$sds[mean_width_signal$sensillum_type == "mechano" & mean_width_signal$signal == "both"], digits = 1)` ~\mu$m for visual, chemical, and combined signalers, respectively; Fig. \@ref(fig:signal-plots)a).

Sensilla lengths are different between olfactory and mechanosensory, but they are not significantly different between species of signaling type (Fig. \@ref(fig:signal-plots)c).  Mean olfactory sensilla lengths were 
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "visual"], digits = 1)` ~\mu$m for visual signalers, 
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "chemical"], digits = 1)` ~\mu$m for chemical signalers, and 
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "both"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "olfactory" & mean_length_signal$signal == "both"], digits = 1)` ~\mu$m for species displaying both strategies. Mean mechanosensory sensilla lengths were
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "visual"], digits = 1)` ~\mu$m for visual signalers, 
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "chemical"], digits = 1)` ~\mu$m for chemical signalers, and 
$`r signif(mean_length_signal$means[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "both"], digits = 3)` \pm `r signif(mean_length_signal$sds[mean_length_signal$sensillum_type == "mechano" & mean_length_signal$signal == "both"], digits = 1)` ~\mu$m for species displaying both strategies.


Furthermore, the arrangements of sensilla on the antennae segments does not appear to vary with signaling strategy (Fig. \@ref(fig:signal-plots)c, d). The mean densities of olfactory sensilla were
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "visual"], digits = 1)`$ sensilla per mm^2^ for visual signalers, 
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "chemical"], digits = 1)`$ sensilla per mm^2^ for chemical signalers, and 
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "both"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "olfactory" & mean_density_signal$signal == "both"], digits = 1)`$ sensilla per mm^2^ for species with a combined strategy. For mechanosensory sensilla, densities were 
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "visual"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "visual"], digits = 1)`$ sensilla per mm^2^, 
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "chemical"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "chemical"], digits = 1)`$ sensilla per mm^2^, and 
$`r signif(mean_density_signal$means[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "both"], digits = 3)` \pm `r signif(mean_density_signal$sds[mean_density_signal$sensillum_type == "mechano" & mean_density_signal$signal == "both"], digits = 1)`$ sensilla per mm^2^ for visual, chemical, and combined signalers, respectively. Similar results were found for mean distances between sensilla, reported in Fig. \@ref(fig:signal-plots)d. 

The total number of sensilla reflects the total sensory surface area available to an animal during olfaction. For the species sampled in this study, the estimated mean number of sensilla per segment were not significantly different between species of signaling types for mechanosensory or olfactory sensilla (Fig. \@ref(fig:count-plot)). The mean numbers of olfactory sensilla per segment were 
$(`r signif(mean_counts_signal$means[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "visual"]/10e7, digits = 3)` \pm `r signif(mean_counts_signal$sds[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "visual"]/10e7, digits = 1)`) \times 10^8$, 
$(`r signif(mean_counts_signal$means[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "chemical"]/10e7, digits = 3)` \pm `r signif(mean_counts_signal$sds[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "chemical"]/10e7, digits = 1)`) \times 10^8$, and 
$(`r signif(mean_counts_signal$means[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "both"]/10e7, digits = 3)` \pm `r signif(mean_counts_signal$sds[mean_counts_signal$sensillum_type == "olfactory" & mean_counts_signal$signal == "both"]/10e7, digits = 1)`) \times 10^8$ sensilla for visual, chemical, and combined signaling, respectively. When mean sensilla counts per segment were extended to estimate the total number of sensilla on an antenna for complete specimens, the mean number of sensilla was $(`r signif(mean(est_complete_counts_species$mean_total[est_complete_counts_species$signal == "visual"])/10e8, digits = 3)` \pm `r signif(sd(est_complete_counts_species$mean_total[est_complete_counts_species$signal == "visual"])/10e8, digits = 1)`) \times 10^9$ for visual signalers and $(`r signif(mean(est_complete_counts_species$mean_total[est_complete_counts_species$signal == "chemical"])/10e8, digits = 3)` \pm `r signif(sd(est_complete_counts_species$mean_total[est_complete_counts_species$signal == "chemical"])/10e8, digits = 1)`) \times 10^9$ for chemical signalers. 

```{r count-plot, echo=FALSE, warning=FALSE, message=FALSE, fig.height=4.25, fig.width=6.5, fig.cap="Estimated olfactory sensilla counts per flagellar segment. a. Species mean estimated count of olfactory sensilla versus signaling strategy. Each point is a species mean with error bars representing the standard deviation of estimated sensillum counts. b. Species-mean estimated counts presented on a phylogenetic tree, color indicates signaling strategy (same as part a), size of colored point indicates relative size of sensillum count."}
p_boxplot <- ggplot(all_segs_olf, aes(signal, mean_est, fill = signal)) + 
  geom_boxplot(position = "dodge", alpha = 0.5, outlier.shape = NA) + 
  geom_pointrange(mapping = aes(ymin = mean_est - sd_est, ymax = mean_est + sd_est),
                    position = position_jitterdodge(), 
                    pch = 21, alpha = 1) +
  scale_fill_manual(values = signal_colors) +
  geom_text_repel(aes(label = species), fill = "white", max.overlaps = 1, min.segment.length = 0, size = 3) +
  ylab("Mean number of olfactory\nsensilla per segment") +
  xlab("") +
  theme_bw() +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 25, hjust = 1))
p_count_tree <- ggtree(bug_tree_2) + 
  geom_tiplab(offset = 0.04, size = 3) + 
  geom_tippoint(aes(fill = signal, size = mean_est), 
                color = "black", shape = 21) +
  scale_fill_manual(values = signal_colors) +
  scale_size_binned(range = c(0.1, 5)) +
  xlim(0,2) +
  theme(legend.position = "none")

p_boxplot + p_count_tree + 
  plot_layout(widths = c(1,4)) +
  plot_annotation(tag_levels = "a")

if(save_figs){
  dir.create("./doc/figures/figure4/", showWarnings = F)
  ggsave("./doc/figures/figure4/count-plots.pdf", last_plot(), height = 4.25, width = 6.5)
}
```

The type of olfactory sensilla were also not different between signaling strategies; Fig. \@ref(fig:trichoid-fig)a presents comparisons of mean number of sensilla per segment. Mean numbers of basiconica sensilla per segment were $(`r signif(mean(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "basiconica" & mean_counts_olf_signal$signal == "visual"])/1e7, digits = 3)` \pm `r signif(sd(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "basiconica" & mean_counts_olf_signal$signal == "visual"])/1e7, digits = 1)`) \times 10^8$ and $(`r signif(mean(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "basiconica" & mean_counts_olf_signal$signal == "chemical"])/1e8, digits = 3)` \pm `r signif(sd(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "basiconica" & mean_counts_olf_signal$signal == "chemical"])/1e8, digits = 1)`) \times 10^9$ for visual and chemical signalers, respectively. For trichodea sensilla, the means were $(`r signif(mean(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "trichoid" & mean_counts_olf_signal$signal == "visual"])/1e7, digits = 3)` \pm `r signif(sd(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "trichoid" & mean_counts_olf_signal$signal == "visual"])/1e7, digits = 1)`) \times 10^8$ and $(`r signif(mean(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "trichoid" & mean_counts_olf_signal$signal == "chemical"])/1e8, digits = 3)` \pm `r signif(sd(mean_counts_olf_signal$means[mean_counts_olf_signal$olfactory_type == "trichoid" & mean_counts_olf_signal$signal == "chemical"])/1e8, digits = 1)`) \times 10^9$ for visual and chemical signalers, respectively. 

```{r trichoid-fig, message=FALSE, warning=FALSE, fig.height=3.5, fig.width=6.5, fig.cap="Mean number of olfactory sensilla per flagellar segment by type, signal, and sex. a. Olfactory sensilla of each type (basiconica, trichodea, and capitular) for each type grouped by signaling strategy. b. Olfactory sensilla of each type (basiconica, trichodea, and capitular) for each type grouped by sex."}
p_olf_counts_signal <- test_olf_counts_signal$plot + 
  scale_fill_manual(values = signal_colors) + 
  ylab("Mean number of sensilla\nper segment") + 
  theme(legend.position = "bottom") 
p_olf_counts_sex <- test_olf_counts_sex$plot + 
  scale_fill_manual(values = sex_colors) + 
  ylab("Mean number of sensilla\nper segment")+ 
  theme(legend.position = "bottom")

p_olf_counts_signal + p_olf_counts_sex +plot_annotation(tag_levels = "a")

if(save_figs){
  dir.create("./doc/figures/figure5/", showWarnings = F)
  ggsave("./doc/figures/figure5/trichoid-plots.pdf", last_plot(), height = 3.5, width = 6.5)
}
```

The fraction of sensilla of each type also did not differ between fireflies of different signaling strategies. Fig. \@ref(fig:fraction)a shows the fraction of mechanosensory and olfactory sensilla split between visual and chemical signalers, and Fig. \@ref(fig:fraction)c as well as the fraction of basiconica, trichodea, and capitular sensilla as a fraction of total olfactory sensilla. 

```{r fraction, message=FALSE, warning=FALSE, fig.width = 6.5, fig.height = 4.5, fig.cap="Fraction of mechanosensory and olfactory sensillum coverage on the antennae.  a,b: Fraction of mechanosensory or olfactory sensilla by sexual signaling strategy (a) and sex (b). c,d: Fraction of olfactory sensilla by type coverage on the antennae by sexual signaling strategy (c) and sex (d)."}

p_frac_signal <- test_all_fractions_signal$plot + 
  scale_fill_manual(values = sensillum_colors, name = "Sensillum type")
  
p_frac_sex <- test_all_fractions_sex$plot + 
  scale_fill_manual(values = sensillum_colors, name = "Sensillum type")

p_frac_signal_olf <- test_olf_fractions_signal$plot +
  scale_fill_manual(values = olfactory_colors, name = "Specialized\ntype")
p_frac_sex_olf <- test_olf_fractions_sex$plot + 
  scale_fill_manual(values = olfactory_colors, name = "Specialized\ntype")


(p_frac_signal + p_frac_sex + plot_layout(guides = "collect") & theme(legend.position = "right")) / 
  (p_frac_signal_olf + p_frac_sex_olf + plot_layout(guides = "collect")) + 
  plot_annotation(tag_levels = "a") 

if(save_figs){
  dir.create("./doc/figures/figure6/", showWarnings = F)
  ggsave("./doc/figures/figure6/fraction-plots.pdf", last_plot(), height = 4.5, width = 6.5)
}
```



## Sex does not affect sensilla morphometrics or arrangements

```{r summary-values-sex, include=FALSE}
mean_width_sex <- test_widths_sex$bar_means %>%
  group_by(sensillum_type, sex) %>%
  summarize(means = mean(mean, na.rm=T), sds = sd(mean, na.rm=T))

mean_length_sex <- test_lengths_sex$bar_means %>%
  group_by(sensillum_type, sex) %>%
  summarize(means = mean(mean, na.rm=T), sds = sd(mean, na.rm=T))

mean_density_sex <- test_all_density_sex$bar_means %>%
  group_by(sensillum_type, sex) %>%
  summarize(means2 = mean(means, na.rm=T), sds = sd(means, na.rm=T))
colnames(mean_density_sex)[3] <- "means"

mean_counts_sex <- test_all_counts_sex$bar_means %>%
  group_by(sensillum_type, sex) %>%
  summarize(means2 = mean(means, na.rm=T), sds = sd(means, na.rm=T))
colnames(mean_counts_sex)[3] <- "means"

compare_means_olf <- mean_counts_all[mean_counts_all$sensillum_type == "olfactory",]
compare_means_olf$signal[compare_means_olf$signal == "both"] <- "chemical"

compare_means_mechano <- mean_counts_all[mean_counts_all$sensillum_type == "mechano",]
compare_means_mechano$signal[compare_means_mechano$signal == "both"] <- "chemical"

```





```{r sex-plots, message=FALSE, warning=FALSE, fig.height=5.5, fig.width = 6.5, fig.cap="Antenna attributes do not vary with sex. Mean widths of the medial sensilla (a), mean lengths of sensilla (b), mean density of sensilla (c), mean distances between sensilla (d), and count of sensilla for both mechanosensory and olfactory sensilla across sexes. See Table \\@ref(tab:sex-ptable) for sample sizes and p-values for each comparison."}

p_width_sex <- test_widths_sex$plot + scale_fill_manual(values = sex_colors, 
                                                    labels = c("male", "female",
                                                               "not available"))
p_length_sex <- test_lengths_sex$plot + scale_fill_manual(values = sex_colors, 
                                                    labels = c("male", "female",
                                                               "not available"))
p_sex_density <- test_all_density_sex$plot + 
  scale_fill_manual(values = sex_colors, guide = F) 
p_sex_dists <- test_all_mean_dists_sex$plot + 
  scale_fill_manual(values = sex_colors, guide = F)
p_sex_counts <- test_all_counts_sex$plot + 
  scale_fill_manual(values = sex_colors, guide = F)

(p_width_sex + p_length_sex) / 
  (p_sex_density + p_sex_dists) / 
  #(free(p_sex_counts)) +  
  plot_layout(guides = "collect") +
  plot_annotation(tag_levels = "a") & theme(legend.position = "bottom", 
                                            plot.tag = element_text(vjust = 2))

if(save_figs){
  dir.create("./doc/figures/figure7/", showWarnings = F)
  ggsave("./doc/figures/figure7/sex-plots.pdf", last_plot(), height = 5.5, width = 6.5)
}
```

No significant differences were found with sex on any measurement associated with sensilla count, measurement, or morphometrics (Fig. \@ref(fig:sex-plots)). Table \@ref(tab:sex-ptable) presents $p$-values and sample sizes ($n$) of comparisons between mean values of individuals against sex. 

Sensilla morphometrics were similar across sex with no significant comparisons identified (Fig. \@ref(fig:sex-plots)a, b). The mean widths of olfactory sensilla were
$`r signif(mean_width_sex$means[mean_width_sex$sensillum_type == "olfactory" & mean_width_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_width_sex$sds[mean_width_sex$sensillum_type == "olfactory" & mean_width_sex$sex == "male"][1], digits = 1)` ~\mu$m for females, 
$`r signif(mean_width_sex$means[mean_width_sex$sensillum_type == "olfactory" & mean_width_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_width_sex$sds[mean_width_sex$sensillum_type == "olfactory" & mean_width_sex$sex == "male"][1], digits = 1)` ~\mu$m for males with no significance between means (Fig. \@ref(fig:sex-plots)a). Similar widths were found for mechanosensory sensilla across sexes 
($`r signif(mean_width_sex$means[mean_width_sex$sensillum_type == "mechano" & mean_width_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_width_sex$sds[mean_width_sex$sensillum_type == "mechano" & mean_width_sex$sex == "female"][1], digits = 1)` ~\mu$m, 
$`r signif(mean_width_sex$means[mean_width_sex$sensillum_type == "mechano" & mean_width_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_width_sex$sds[mean_width_sex$sensillum_type == "mechano" & mean_width_sex$sex == "male"][1], digits = 1)` ~\mu$m, for females and males, respectively; Fig. \@ref(fig:sex-plots)a). 
The mean lengths of olfactory sensilla were
$`r signif(mean_length_sex$means[mean_length_sex$sensillum_type == "olfactory" & mean_length_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_length_sex$sds[mean_length_sex$sensillum_type == "olfactory" & mean_length_sex$sex == "female"][1], digits = 1)` ~\mu$m for females and $`r signif(mean_length_sex$means[mean_length_sex$sensillum_type == "olfactory" & mean_length_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_length_sex$sds[mean_length_sex$sensillum_type == "olfactory" & mean_length_sex$sex == "male"][1], digits = 1)` ~\mu$m for males. 
The mean lengths of mechanosensory sensilla were $`r signif(mean_length_sex$means[mean_length_sex$sensillum_type == "mechano" & mean_length_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_length_sex$sds[mean_length_sex$sensillum_type == "mechano" & mean_length_sex$sex == "female"][1], digits = 1)` ~\mu$m for females and $`r signif(mean_length_sex$means[mean_length_sex$sensillum_type == "mechano" & mean_length_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_length_sex$sds[mean_length_sex$sensillum_type == "mechano" & mean_length_sex$sex == "male"][1], digits = 1)` ~\mu$m for males.


```{r sex-ptable, message=FALSE, warning=FALSE}
kable(tab_sex_df, "simple",
      digits = 3, align = "c",
      #row.names = tab_row_names,
      col.names = tab_col_names,
      caption = "Phylogenetically corrected $p$-value comparisons of individuals against sex. Number of individuals in the comparison ($n$) is noted in parentheses beside each value.")
```

Similarly, the arrangements of sensilla on the antennae segments do not appear to vary with sex (Fig. \@ref(fig:sex-plots)c, d). The mean densities of olfactory sensilla were
$`r signif(mean_density_sex$means[mean_density_sex$sensillum_type == "olfactory" & mean_density_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_density_sex$sds[mean_density_sex$sensillum_type == "olfactory" & mean_density_sex$sex == "female"][1], digits = 1)`$ sensilla per mm^2^ for females and
$`r signif(mean_density_sex$means[mean_density_sex$sensillum_type == "olfactory" & mean_density_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_density_sex$sds[mean_density_sex$sensillum_type == "olfactory" & mean_density_sex$sex == "male"][1], digits = 1)`$ sensilla per mm^2^ for males. 
For mechanosensory sensilla, densities were 
$`r signif(mean_density_sex$means[mean_density_sex$sensillum_type == "mechano" & mean_density_sex$sex == "female"][1], digits = 3)` \pm `r signif(mean_density_sex$sds[mean_density_sex$sensillum_type == "mechano" & mean_density_sex$sex == "female"][1], digits = 1)`$ sensilla per mm^2^ and 
$`r signif(mean_density_sex$means[mean_density_sex$sensillum_type == "mechano" & mean_density_sex$sex == "male"][1], digits = 3)` \pm `r signif(mean_density_sex$sds[mean_density_sex$sensillum_type == "mechano" & mean_density_sex$sex == "male"][1], digits = 1)`$ sensilla per mm^2^ for females and males, respectively. Similar results were found for mean distances between sensilla, reported in Fig. \@ref(fig:sex-plots)d. The mean numbers of olfactory sensilla per segment were 
$(`r signif(mean_counts_sex$means[mean_counts_sex$sensillum_type == "olfactory" & mean_counts_sex$sex == "female"][1]/10e7, digits = 3)` \pm `r signif(mean_counts_sex$sds[mean_counts_sex$sensillum_type == "olfactory" & mean_counts_sex$sex == "female"][1]/10e7, digits = 1)`) \times 10^8$, 
$(`r signif(mean_counts_sex$means[mean_counts_sex$sensillum_type == "olfactory" & mean_counts_sex$sex == "male"][1]/10e7, digits = 3)` \pm `r signif(mean_counts_sex$sds[mean_counts_sex$sensillum_type == "olfactory" & mean_counts_sex$sex == "male"][1]/10e7, digits = 1)`) \times 10^8$ for females and males, respectively. 


```{r counts-signal-sex, warning=FALSE, message=FALSE, fig.height=5.5, fig.width=6.5, fig.cap="Mean number of sensilla per segment broken down by sexual signaling strategy and sex: a. all mechanosensory sensilla, b. all olfactory sensilla, c. trichodea sensilla, d. basiconica sensilla."}
p_f4_mechano <- ggplot(compare_means_mechano,
       aes(signal, means, fill = sex)) +
  geom_boxplot(alpha = 0.9, outlier.shape = NA) +
  #geom_point(pch = 21, size = 2) +
  geom_pointrange(mapping = aes(ymin = means - sds, ymax = means + sds),
                    position = position_jitterdodge(jitter.width = 0.4),
                    pch = 21, alpha = 1) +
  scale_fill_manual(values = sex_colors) +
  ylab("Mean number of sensilla\nper segment") +
  ggtitle("Mechanosensory sensilla") +
  theme_minimal() 

p_f4_olfactory <- ggplot(compare_means_olf[compare_means_olf$sensillum_type == "olfactory" & 
                                             compare_means_olf$olfactory_type == "all",], 
       aes(signal, means, fill = sex)) + 
  geom_boxplot(alpha = 0.9, outlier.shape = NA) + 
  #geom_point(pch = 21, size = 2) +
  geom_pointrange(mapping = aes(ymin = means - sds, ymax = means + sds),
                    position = position_jitterdodge(jitter.width = 0.4), 
                    pch = 21, alpha = 1) +
  scale_fill_manual(values = sex_colors) + #, labels = c("male", "female",
                                          #           "not available")) +
  ylab("Mean number of sensilla\nper segment") +
  ggtitle("All Olfactory sensilla") +
  theme_minimal() 

p_f4_trichoid <- ggplot(compare_means_olf[compare_means_olf$olfactory_type == "trichoid",], 
       aes(signal, means, fill = sex)) + 
  geom_boxplot(alpha = 0.9, outlier.shape = NA) + 
  #geom_point(pch = 21, size = 2) +
  geom_pointrange(mapping = aes(ymin = means - sds, ymax = means + sds),
                    position = position_jitterdodge(jitter.width = 0.4), 
                    pch = 21, alpha = 1) +
  scale_fill_manual(values = sex_colors) + #, labels = c("male", "female",
                                          #           "not available")) +
  ylab("Mean number of sensilla\nper segment") +
  ggtitle("Trichodea sensilla") +
  theme_minimal() 

p_f4_basiconica <- ggplot(compare_means_olf[compare_means_olf$olfactory_type == "basiconica",], 
       aes(signal, means, fill = sex)) + 
  geom_boxplot(alpha = 0.9, outlier.shape = NA) + 
  #geom_point(pch = 21, size = 2) +
  geom_pointrange(mapping = aes(ymin = means - sds, ymax = means + sds),
                    position = position_jitterdodge(jitter.width = 0.4), 
                    pch = 21, alpha = 1) +
  scale_fill_manual(values = sex_colors) + #, labels = c("male", "female",
                                          #           "not available")) +
  ylab("Mean number of sensilla\nper segment") +
  ggtitle("Basiconica sensilla") +
  theme_minimal() 

(p_f4_mechano + p_f4_olfactory) / (p_f4_trichoid + p_f4_basiconica) +
  plot_annotation(tag_levels = "a") +
  plot_layout(guides = "collect") & theme(legend.position = "bottom")

if(save_figs){
  dir.create("./doc/figures/figure8/", showWarnings = F)
  ggsave("./doc/figures/figure8/breakdown-plots.pdf", last_plot(), height = 5.5, width = 6.5)
}
```

When sex and signal are taken into account, such as the breakdown of these categories in Fig. \@ref(fig:counts-signal-sex), there appears to be no indication that males of chemical or visual signaling species have more olfactory sensilla. However, only one female specimen of a chemical signaling species was included in our sample so we were unable to statistically compare these groups together. It should be noted that the single chemical-signaling female specimen had a higher number of basiconica sensilla and a similar number of trichodea sensilla compared to males. 


# Discussion 

Sensillum and antenna morphometrics play a role in the capture of odorant molecules from the surrounding air by influencing the flow of air over sensory structures and providing surface area for sensory structures. Despite the arrangement and structure of olfactory sensilla being important for odorant capture in other organisms, our study shows that various measurements of sensilla do not appear to differ between fireflies with different signaling strategies. Visual and chemical signaling species have the same size and length of olfactory sensilla, as well as the same densities, mean distances between sensilla, and total estimated counts of sensilla. Maintenance of these arrangements will influence total capture surface area as well as the fluid flow through these structures. 

Our result stand in contrast to several studies on sensory structures of firefly antennae which have found significant differences in sensilla between species that have primary visual or chemical signaling strategies. @pacheco2024antennal found similar results on total counts of chemosensory sensilla between three diurnal and four nocturnal species but significantly more dense sensilla between these types. Our study included only one female specimen of chemical signaling species, making a direct comparison not possible. However, males of chemical signaling species showed lower numbers of olfactory sensilla overall and basiconica sensilla and low variation than the lone female specimen (Fig. \~ref(fig:counts-signal-sex)b). 

Our study focused on the morphometrics of these structures, including the widths, lengths, densities, and mean distances between sensilla that would influence fluid flow over and odor capture by the antenna. Our results suggest that that the selective forces surrounding the maintenance of these arrangements may be heavier than the effects of sexual selection. Sensilla on firefly antennae serve several functions beyond sex pheromone detection, such as the detection of plant volatiles, aggregation pheromones, and moisture [@keil1984mechanosensitive; @lopes2002fine; @pacheco2024antennal]. It is possible that sensilla morphometrics and arrangements are under different selective pressures than simply sexual selection driving differences between species or between sexes, as are many examples of elaborate traits [e.g.  @rubin2023sexual]. Olfactory sensilla in terrestrial pancrustanceans tend to be reduced to similar sizes and shapes, being short and peg-like or leaf-like [@stensmyr2005insect, @waldrop2016hermitcrab], indicating that the interaction between fluid containing odorant molecules and sensory structures may be similar across species. This form could represent the smallest, most compact, and inexpensive way to create and maintain arrays of olfactory sensilla. 

Additionally, denser arrays do not necessarily translate to greater sensor sensitivity due to the physics of odorant capture. @Loudon2000 demonstrated that silkworm antennae are so dense that active ventilation is required for the inner-most sensilla to be exposed to air containing new odorant samples, and the structure of these antennae divert air currents through the dense array [@loudon2005divergence]. This has been observed for waterborne creatures such as crabs and has been shown more generally in computational modeling of odorant capture by hair arrays [@waldrop2016bluehermit; @waldrop2018entmodel]. 

However, few sensilla types and their functions are well characterized across the species in this study. Recent work by @pacheco2024antennal characterized sensilla and found several new types and observed that diurnal species had 3-5 types of chemoreceptor sensilla compared to 1-3 on nocturnal species. Many of these sensilla have unknown target-odor receptors. The specific function of olfactory sensilla types are not well known for most fireflies, so it is unknown whether the olfactory sensilla of either basiconica or trichodea are specifically tuned to sex pheromones and would therefore be under pressure from sexual selection. These olfactory sensilla could be used for general olfactory tasks other than sex pheromone signaling and would therefore not be expected to differ. It is likely that the specificity of some sensilla types to pheromones mediating reproductive efforts is more important that the overall counts, arrangement, and morphometrics of olfactory sensilla overall. 

Furthermore, the presence of a particular type of sensilla may not indicate physiological function.  @lower2023identification found that basiconica sensilla on the antennae of male *Photinus corruscus* responded to to the candidate sex pheromone (1*S*)-*exo*-3-hydroxycamphor produced by females, the first confirmation of a sex pheromone in a firefly. *P. corruscus* is a diurnal species with females presumably using sex pheromones to attract mates. However, the same type of basiconica sensilla were found on the antennae of both male and female *P. corruscus* by @pacheco2024antennal, suggesting that females possess the same sensilla that react to sex pheromones but either they are not physiologically active or these signals are ignored. Either way, sexual dimorphism in the relevant sensilla would not be observable, consistent with the results of our study. 

Further study is needed to determine the extent to which firefly antennae differ when using visual or chemical signaling strategies to find conspecific mates at a distance. This work focused on wide taxonomic sampling but in a limited number of specimens per species. This limits the statistical power of the study, although we found remarkably similar measurements across the species studied. Results were also limited by small amount of females in the sample to make strong conclusions on dimorphic traits within chemical signalers. Additionally, computational studies of odor capture would be a useful way to determine whether or not small differences in morphometrics, density, and arrangement of sensilla would impact the overall signal experienced by individuals. 


# Funding

This material is based upon work supported by, or in part by, the U.S. Army Research Office under contract number #W911NF2210037 (to Y. He and L.D. Waldrop). 

# Acknowledgements

The authors would like to thank Brian Brown (Los Angeles County Natural History Museum) for the initial hypothesis and his generous assistance with specimens; Karen Ngo, Karishma Setya, and Anne Wilber for their help collecting data; and Molla Islam for assistance with scanning electron microscopy. 

# Conflicts of Interest

The authors have no conflicts to declare.



# References
